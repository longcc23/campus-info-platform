# ğŸ”„ Supabase æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ REST API

## é—®é¢˜

Supabase JavaScript SDK åœ¨å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸­éœ€è¦å¤§é‡ polyfillï¼ˆURL, fetch, Headers, AbortSignal ç­‰ï¼‰ï¼Œå¯¼è‡´ï¼š
- ä»£ç å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤
- å®¹æ˜“å‡ºç°å…¼å®¹æ€§é—®é¢˜
- è°ƒè¯•å›°éš¾

## è§£å†³æ–¹æ¡ˆ

**ç›´æ¥ä½¿ç”¨ Supabase REST API**ï¼Œå®Œå…¨ç»•è¿‡ SDKï¼Œä½¿ç”¨ `Taro.request` ç›´æ¥è°ƒç”¨ã€‚

## ä¼˜åŠ¿

âœ… **ç®€å•ç›´æ¥**ï¼šä¸éœ€è¦ä»»ä½• polyfill  
âœ… **ç¨³å®šå¯é **ï¼šç›´æ¥ä½¿ç”¨ Taro.requestï¼Œå…¼å®¹æ€§æœ€å¥½  
âœ… **æ˜“äºè°ƒè¯•**ï¼šä»£ç æ¸…æ™°ï¼Œé”™è¯¯ä¿¡æ¯æ˜ç¡®  
âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒæ‰€æœ‰ CRUD æ“ä½œ  

## ä½¿ç”¨æ–¹æ³•

### 1. æ›´æ–°å¯¼å…¥

åœ¨ `src/pages/index/index.tsx` ä¸­ï¼š

```typescript
// æ—§ç‰ˆæœ¬ï¼ˆä½¿ç”¨ SDKï¼‰
// import { getEvents, type Event } from '../../utils/supabase'

// æ–°ç‰ˆæœ¬ï¼ˆä½¿ç”¨ REST APIï¼‰
import { getEvents, type Event } from '../../utils/supabase-rest'
```

### 2. API æ–¹æ³•

æ‰€æœ‰ API æ–¹æ³•ä¿æŒä¸å˜ï¼š

```typescript
// è·å–æ‰€æœ‰æ´»åŠ¨
const { data, error } = await getEvents()

// æŒ‰ç±»å‹ç­›é€‰
const { data, error } = await getEvents({ type: 'recruit' })

// è·å–å•ä¸ªæ´»åŠ¨
const { data, error } = await getEventById(1)

// åˆ›å»ºæ´»åŠ¨ï¼ˆéœ€è¦è®¤è¯ï¼‰
const { data, error } = await createEvent(newEvent)

// æ›´æ–°æ´»åŠ¨ï¼ˆéœ€è¦è®¤è¯ï¼‰
const { data, error } = await updateEvent(1, updates)
```

### 3. é”™è¯¯å¤„ç†

```typescript
const { data, error } = await getEvents()

if (error) {
  console.error('è·å–å¤±è´¥:', error.message)
  Taro.showToast({
    title: error.message,
    icon: 'none'
  })
  return
}

// ä½¿ç”¨ data
console.log('æ´»åŠ¨åˆ—è¡¨:', data)
```

## æŠ€æœ¯å®ç°

### REST API ç«¯ç‚¹

Supabase ä½¿ç”¨ PostgRESTï¼ŒREST API ç«¯ç‚¹ä¸ºï¼š
```
https://{project-url}/rest/v1/{table-name}
```

### è®¤è¯

ä½¿ç”¨ Header è®¤è¯ï¼š
```
apikey: {ANON_KEY}
Authorization: Bearer {ANON_KEY}
```

### æŸ¥è¯¢å‚æ•°

ä½¿ç”¨ PostgREST æŸ¥è¯¢è¯­æ³•ï¼š
- `?id=eq.1` - ç­‰äº
- `?type=eq.recruit` - ç±»å‹ç­‰äº recruit
- `?order=created_at.desc` - æ’åº
- `?limit=10` - é™åˆ¶æ•°é‡

## æ–‡ä»¶ç»“æ„

```
src/utils/
â”œâ”€â”€ supabase.ts          # æ—§ç‰ˆæœ¬ï¼ˆä½¿ç”¨ SDKï¼Œæœ‰ polyfill é—®é¢˜ï¼‰
â”œâ”€â”€ supabase-rest.ts     # æ–°ç‰ˆæœ¬ï¼ˆä½¿ç”¨ REST APIï¼Œæ¨èï¼‰
â””â”€â”€ polyfill.ts          # polyfill å®šä¹‰ï¼ˆä»… SDK ç‰ˆæœ¬éœ€è¦ï¼‰
```

## è¿ç§»æ­¥éª¤

1. âœ… å·²åˆ›å»º `supabase-rest.ts`
2. âœ… å·²æ›´æ–° `index.tsx` ä½¿ç”¨æ–°ç‰ˆæœ¬
3. ğŸ”„ æµ‹è¯•è¿æ¥å’ŒåŠŸèƒ½
4. ğŸ”„ å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå¯ä»¥åˆ é™¤ `supabase.ts` å’Œ `polyfill.ts`

## æ³¨æ„äº‹é¡¹

1. **åŸŸåé…ç½®**ï¼šä»ç„¶éœ€è¦åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½® Supabase åŸŸå
2. **RLS ç­–ç•¥**ï¼šæ•°æ®åº“çš„ RLS ç­–ç•¥ä»ç„¶æœ‰æ•ˆ
3. **è®¤è¯**ï¼šå¦‚æœéœ€è¦è®¤è¯ï¼Œéœ€è¦åœ¨ Header ä¸­æ·»åŠ ç”¨æˆ· token

## æµ‹è¯•

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯•ï¼š

```typescript
// åœ¨ç»„ä»¶ä¸­æµ‹è¯•
useEffect(() => {
  const testConnection = async () => {
    const { data, error } = await getEvents()
    if (error) {
      console.error('âŒ è¿æ¥å¤±è´¥:', error)
    } else {
      console.log('âœ… è¿æ¥æˆåŠŸ!', data)
    }
  }
  testConnection()
}, [])
```

---

**æ¨èä½¿ç”¨ REST API ç‰ˆæœ¬ï¼Œæ›´ç®€å•ã€æ›´ç¨³å®šï¼** ğŸš€

