# 📋 UniFlow V1.1.0 - 管理后台 PRD

**版本**：V1.1.0  
**日期**：2025年12月  
**目标用户**：CDC 老师、班委  
**设计理念**：Human-in-the-Loop (人在回路)

---

## ⚠️ 重要说明

**本文档描述的是管理后台（Web Dashboard），不是小程序。**

- **管理后台**：Web 应用，使用 Next.js + React + Tailwind CSS
- **小程序端**：微信小程序，使用 Taro + React + SCSS（独立应用）

**提供的 React 示例代码**是管理后台的前端设计参考。

---

## 🎯 产品定位

**管理后台 (Admin Console)** 是 CDC 智汇中心的运营工作台，旨在降低内容发布门槛，让不懂技术的老师和班委也能轻松维护信息内容。

### 核心价值

- **AI 辅助**：智能识别和提取，减少人工输入
- **人工审核**：确保内容准确性，把关质量
- **简单易用**：图形化界面，无需技术背景
- **高效发布**：一键发布，实时同步到小程序

---

## 👥 用户角色

### 角色定义

| 角色 | 权限范围 | 使用场景 |
|------|---------|---------|
| **超级管理员** | 全部权限 | 系统配置、账号管理、技术监控 |
| **运营员** | 内容管理 | 发布信息、审核内容、查看数据 |

### 权限矩阵

| 功能 | 超级管理员 | 运营员 |
|------|-----------|--------|
| 登录系统 | ✅ | ✅ |
| AI 识别 | ✅ | ✅ |
| 创建活动 | ✅ | ✅ |
| 编辑活动 | ✅ | ✅ |
| 发布活动 | ✅ | ✅ |
| 删除活动 | ✅ | ✅ |
| 查看数据 | ✅ | ✅ |
| 账号管理 | ✅ | ❌ |
| 系统配置 | ✅ | ❌ |

---

## 🔐 1. 登录与权限管理

### 1.1 登录页面

#### 功能需求

- **登录方式**：邮箱 + 密码
- **封闭式登录**：不开放公开注册
- **账号创建**：
  - 由超级管理员在 Supabase 后台创建
  - 或使用邀请码注册（可选功能）

#### UI 设计

```
┌─────────────────────────────┐
│    CDC 智汇中心 - 管理后台    │
│                             │
│  邮箱: [____________]       │
│  密码: [____________]       │
│                             │
│  [ ] 记住我                  │
│                             │
│      [ 登 录 ]              │
│                             │
│  忘记密码？                  │
└─────────────────────────────┘
```

#### 交互流程

1. 用户输入邮箱和密码
2. 点击"登录"按钮
3. 系统验证身份
4. 登录成功，跳转到 Dashboard
5. 登录失败，显示错误提示

### 1.2 权限控制

- ✅ 基于 Supabase RLS
- ✅ 页面级权限拦截
- ✅ 操作按钮权限控制
- ✅ 数据访问权限限制

---

## 🤖 2. AI 智能采集台 (The "Magic Box")

这是管理后台的**核心页面**，是整个系统的"魔法盒子"。

### 2.1 页面布局

**参考提供的 React 示例代码布局**：

```
┌─────────────────────────────────────────────────────────┐
│  AI 智能发布台                              [TopNav]     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  输入方式 Tab: [文本/群消息] [公众号链接] [海报图片]     │
│                                                         │
│  ┌─────────────────────┬───────────────────────────┐   │
│  │                     │                           │   │
│  │   原始素材区          │    AI 预览区               │   │
│  │                     │                           │   │
│  │  ┌───────────────┐ │  ┌─────────────────────┐  │   │
│  │  │               │ │  │ [✓] 识别结果确认    │  │   │
│  │  │  [文本输入框] │ │  │ AI Confidence: 98%  │  │   │
│  │  │               │ │  ├─────────────────────┤  │   │
│  │  │               │ │  │ 活动标题:           │  │   │
│  │  │               │ │  │ [可编辑输入框]      │  │   │
│  │  │               │ │  ├─────────────────────┤  │   │
│  │  │               │ │  │ 类型: [下拉选择]    │  │   │
│  │  │               │ │  │ 来源群: [输入框]    │  │   │
│  │  │               │ │  ├─────────────────────┤  │   │
│  │  │               │ │  │ [📅日期] [🕐时间]    │  │   │
│  │  │               │ │  │ [📍地点]            │  │   │
│  │  │               │ │  ├─────────────────────┤  │   │
│  │  │               │ │  │ AI 摘要: [文本域]   │  │   │
│  │  │               │ │  ├─────────────────────┤  │   │
│  │  │               │ │  │ 自动标签: [标签组]  │  │   │
│  │  └───────────────┘ │  └─────────────────────┘  │   │
│  │                     │                           │   │
│  │  [🪄 开始识别]       │  [存为草稿] [确认并发布]  │   │
│  │                     │                           │   │
│  └─────────────────────┴───────────────────────────┘   │
│                                                         │
│  AI Logs (处理中显示):                                  │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 🔄 读取非结构化数据...                           │   │
│  │ Calling OpenAI API (gpt-4o)...                  │   │
│  │ Extracting entities...                          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**设计要点**：
- 左侧输入区：卡片式设计，带 Tab 切换
- 右侧预览区：可编辑表单，实时预览
- AI 处理日志：深色终端风格，显示处理过程
- 按钮状态：加载中显示 Spinner 动画

### 2.2 多模态输入

#### 2.2.1 文本输入

**功能特性**：
- ✅ 大文本输入框（支持长文本）
- ✅ 支持粘贴微信聊天记录
- ✅ 支持 Markdown 格式预览
- ✅ 字数统计
- ✅ 清空按钮

**使用场景**：
- 老师复制微信群消息
- 粘贴到输入框
- 点击"识别"按钮

#### 2.2.2 URL 输入

**功能特性**：
- ✅ URL 输入框
- ✅ 支持公众号链接
- ✅ 支持文档链接（腾讯文档、Google Docs 等）
- ✅ 自动识别链接类型
- ✅ 预览链接内容（可选）

**使用场景**：
- 老师复制公众号文章链接
- 粘贴到 URL 输入框
- 点击"识别"按钮，自动获取网页内容并解析

#### 2.2.3 图片上传

**功能特性**：
- ✅ 拖拽上传
- ✅ 点击上传
- ✅ 支持多图上传
- ✅ 图片预览
- ✅ 支持 PNG、JPG、JPEG 格式
- ✅ 图片压缩（可选）

**使用场景**：
- 老师上传活动海报图片
- 系统 OCR 识别图片文字
- AI 解析结构化信息

### 2.3 AI 预处理流程

#### 2.3.1 识别按钮

**点击"识别"按钮后的流程**：

```
1. 验证输入内容（文本/URL/图片）
   ↓
2. 显示加载状态（Loading）
   ↓
3. 调用 AI 解析 API
   ├─ 文本：直接调用 LLM
   ├─ URL：先获取网页内容，再调用 LLM
   └─ 图片：先 OCR，再调用 LLM
   ↓
4. 解析返回结构化数据
   ↓
5. 自动填充到右侧表单
   ↓
6. 显示"识别完成"提示
```

#### 2.3.2 AI 提取字段

AI 需要提取以下字段：

| 字段 | 说明 | 示例 |
|------|------|------|
| **标题** | 活动/招聘名称 | "Google Office Tour & 2026 暑期实习预热" |
| **类型** | recruit / activity / lecture | activity |
| **日期** | 活动日期 | "2025-12-04" |
| **时间** | 活动时间 | "14:00 - 16:00" |
| **地点** | 活动地点 | "Google Beijing Office" |
| **截止时间** | 报名截止（招聘） | "2025-12-10" |
| **正文** | 活动详细描述 | Markdown 格式 |
| **标签** | 自动提取的关键词 | ["企业参访", "外企", "Office Tour"] |
| **来源群** | 信息来源（可选） | "CDC 官方通知群 1群" |

#### 2.3.3 错误处理

- ❌ **识别失败**：显示错误提示，允许重试
- ⚠️ **部分识别**：显示警告，允许手动补充
- 🔄 **重试机制**：支持重新识别
- 📝 **降级方案**：识别失败时，允许手动填写

### 2.4 人工校对功能

#### 2.4.1 原文对比

**布局设计**：
- 左侧：原始素材（只读）
- 右侧：AI 提取结果（可编辑）

**交互功能**：
- ✅ **鼠标划词**：在原文中选中文字，快速修正 AI 提取错误
- ✅ **字段高亮**：AI 提取的字段在原文中高亮显示
- ✅ **关联显示**：点击表单字段，原文中对应位置高亮

#### 2.4.2 字段编辑

**编辑功能**：
- ✅ 所有字段都可手动编辑
- ✅ 富文本编辑器（正文字段）
- ✅ 日期选择器（日期字段）
- ✅ 标签输入（支持多选、自定义）
- ✅ 实时预览效果

#### 2.4.3 智能建议

**AI 辅助功能**：
- ✅ 提供备选方案（如：日期识别有多个可能，显示所有选项）
- ✅ 格式验证（如：日期格式校验）
- ✅ 内容补全（如：根据标题推荐标签）

### 2.5 发布操作

#### 2.5.1 保存草稿

- ✅ 点击"保存草稿"按钮
- ✅ 内容保存到数据库，状态为 `draft`
- ✅ 显示"保存成功"提示
- ✅ 可在"内容管理"页面的"草稿箱"查看

#### 2.5.2 直接发布

- ✅ 点击"发布"按钮
- ✅ 验证必填字段
- ✅ 更新状态为 `published`
- ✅ 设置 `published_at` 时间戳
- ✅ 显示"发布成功"提示
- ✅ 小程序端实时更新（轮询或 WebSocket）

#### 2.5.3 发布确认

**发布前确认弹窗**：

```
┌─────────────────────────────┐
│  确认发布                    │
├─────────────────────────────┤
│                             │
│  标题: Google Office Tour   │
│  类型: 活动                  │
│  日期: 2025-12-04           │
│                             │
│  [取消]      [确认发布]      │
│                             │
└─────────────────────────────┘
```

---

## 📝 3. 内容管理 (CMS)

### 3.1 活动列表页面

#### 3.1.1 列表展示

**表格列**：

| 列名 | 说明 | 排序 |
|------|------|------|
| 标题 | 活动标题 | ✅ |
| 类型 | 招聘/活动/讲座 | ✅ |
| 状态 | 已发布/草稿/已过期 | ✅ |
| 发布时间 | 发布时间 | ✅ |
| 浏览量 | 浏览次数 | ✅ |
| 收藏数 | 收藏次数 | ✅ |
| 操作 | 编辑/删除等 | ❌ |

#### 3.1.2 状态筛选

**筛选选项**：
- ✅ 全部
- ✅ 已发布
- ✅ 草稿箱
- ✅ 已过期
- ✅ 已下架

#### 3.1.3 搜索功能

- ✅ 按标题搜索
- ✅ 按类型筛选
- ✅ 按时间范围筛选
- ✅ 组合搜索

#### 3.1.4 操作功能

**单条操作**：
- ✅ 编辑
- ✅ 置顶/取消置顶
- ✅ 下架（已发布 -> 已下架）
- ✅ 删除（带确认弹窗）

**批量操作**：
- ✅ 批量删除
- ✅ 批量发布（草稿 -> 已发布）
- ✅ 批量下架

### 3.2 手动创建活动

如果不使用 AI 识别，也支持传统的"新建活动"：

#### 3.2.1 创建入口

- ✅ 顶部"新建活动"按钮
- ✅ 跳转到编辑页面（空白表单）

#### 3.2.2 表单字段

与 AI 智能采集台的表单相同：
- 标题（必填）
- 类型（必填）
- 日期、时间、地点
- 截止时间（招聘）
- 正文（富文本编辑器）
- 标签
- 来源群

### 3.3 编辑功能

#### 3.3.1 编辑页面

- ✅ 与创建页面共用组件
- ✅ 加载现有数据
- ✅ 支持修改所有字段
- ✅ 保存后更新数据库

#### 3.3.2 编辑历史（可选功能）

- 🔄 记录编辑历史
- 🔄 版本对比
- 🔄 回滚到历史版本

---

## 📊 4. 数据看板 (Dashboard)

### 4.1 核心指标卡片

#### 4.1.1 实时数据

**指标展示**：

```
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
│ 今日浏览  │  │ 累计收藏  │  │ 今日新增  │  │ 活跃用户  │
│   1,234  │  │   567    │  │    12    │  │   890    │
│   +15%   │  │   +8%    │  │   +3     │  │   +10%   │
└──────────┘  └──────────┘  └──────────┘  └──────────┘
```

**数据更新**：
- ✅ 实时更新（WebSocket 或轮询）
- ✅ 时间对比（与昨天/上周对比）
- ✅ 趋势箭头（上升/下降）

### 4.2 图表展示

#### 4.2.1 浏览量趋势

**折线图**：
- X 轴：日期（7天/30天）
- Y 轴：浏览量
- 支持切换时间范围

#### 4.2.2 活动类型分布

**饼图**：
- 招聘占比
- 活动占比
- 讲座占比

#### 4.2.3 热门活动排行

**柱状图**：
- 按浏览量排序 Top 10
- 按收藏数排序 Top 10
- 支持切换排序方式

### 4.3 热度排行

#### 4.3.1 "本周最受关注的 Top 5"

**列表展示**：

| 排名 | 标题 | 类型 | 浏览量 | 收藏数 |
|------|------|------|--------|--------|
| 1 | Google Office Tour | 活动 | 1,234 | 567 |
| 2 | 滴滴-策略运营实习 | 招聘 | 890 | 345 |
| ... | ... | ... | ... | ... |

**排序方式**：
- ✅ 按浏览量排序
- ✅ 按收藏数排序
- ✅ 按搜索量排序（可选）

**作用**：
- 了解学生需求
- 指导内容发布方向
- 发现热门话题

### 4.4 数据导出

#### 4.4.1 导出功能

- ✅ 导出 Excel 报表
- ✅ 导出 CSV 数据
- ✅ 生成 PDF 报告（可选）

#### 4.4.2 导出内容

- ✅ 活动列表
- ✅ 统计数据
- ✅ 图表截图

---

## 🎨 UI/UX 设计规范

### 5.1 设计风格

- **主题色彩**：与小程序保持一致（清华紫）
- **设计语言**：现代化、简洁、专业
- **组件库**：Shadcn/ui + Tailwind CSS

### 5.2 交互规范

- ✅ **加载状态**：所有异步操作显示 Loading
- ✅ **错误提示**：Toast 提示，清晰说明错误原因
- ✅ **成功反馈**：操作成功后显示 Toast
- ✅ **确认弹窗**：删除等危险操作需要确认
- ✅ **表单验证**：实时验证，错误提示清晰

### 5.3 响应式设计

- ✅ 桌面端优先（1920px, 1440px, 1280px）
- ✅ 平板适配（768px+）
- ✅ 移动端支持（可选）

---

## 🔧 技术实现要点

### 6.1 AI 解析服务

#### 6.1.1 文本解析

```typescript
// 输入：长文本（微信群消息）
// 输出：结构化数据
{
  title: string
  type: 'recruit' | 'activity' | 'lecture'
  date?: string
  time?: string
  location?: string
  deadline?: string
  summary?: string
  rawContent: string
  tags: string[]
}
```

#### 6.1.2 URL 解析

```typescript
// 1. 获取网页内容（使用 cheerio）
// 2. 提取文本内容
// 3. 调用 LLM 解析
// 4. 返回结构化数据
```

#### 6.1.3 图片 OCR

```typescript
// 方案1：使用云 OCR 服务（百度 OCR、腾讯 OCR）
// 方案2：客户端 OCR（Tesseract.js）
// 推荐：云服务（准确率高）
```

### 6.2 数据同步

#### 6.2.1 发布后同步

**方案1：轮询**（简单，推荐初期）
- 小程序端每 30 秒轮询一次
- 检查 `published_at` 最新的时间戳

**方案2：WebSocket**（实时，后期优化）
- Supabase Realtime
- 监听 events 表变化

### 6.3 性能优化

- ✅ API 请求缓存
- ✅ 图片 CDN 加速
- ✅ 数据分页加载
- ✅ 虚拟滚动（长列表）

---

## 📋 功能优先级

### P0 - 核心功能（必须完成）

1. ✅ 登录与权限管理
2. ✅ AI 智能采集台（文本输入）
3. ✅ 内容管理（列表、编辑、发布）
4. ✅ 基础数据看板

### P1 - 重要功能（优先完成）

5. ✅ AI 智能采集台（URL、图片输入）
6. ✅ 原文对比和人工校对
7. ✅ 数据看板图表
8. ✅ 批量操作

### P2 - 优化功能（可选）

9. 🔄 编辑历史
10. 🔄 数据导出 PDF
11. 🔄 推送通知
12. 🔄 移动端适配

---

## 🧪 测试用例

### 7.1 功能测试

#### AI 识别测试
- ✅ 测试各种格式的文本输入
- ✅ 测试公众号链接解析
- ✅ 测试图片 OCR 识别
- ✅ 测试错误处理

#### 内容管理测试
- ✅ 创建、编辑、删除活动
- ✅ 状态切换（草稿 -> 发布）
- ✅ 批量操作
- ✅ 搜索和筛选

#### 权限测试
- ✅ 登录验证
- ✅ 权限控制
- ✅ 数据访问限制

### 7.2 性能测试

- ✅ 页面加载速度
- ✅ API 响应时间
- ✅ 大数据量处理

---

## 📅 开发时间线

### Phase 1: 基础搭建（Week 1-2）
- 项目初始化
- 登录系统
- 基础布局

### Phase 2: AI 功能（Week 2-3）
- AI 解析服务
- AI 智能采集台页面
- 测试验证

### Phase 3: 内容管理（Week 3-4）
- 事件列表
- 编辑页面
- 发布功能

### Phase 4: 数据看板（Week 4-5）
- Dashboard 页面
- 图表集成
- 数据导出

### Phase 5: 测试优化（Week 5-6）
- 功能测试
- 性能优化
- 文档完善

---

**文档版本**：V1.1.0  
**最后更新**：2025年12月  
**维护者**：产品团队

