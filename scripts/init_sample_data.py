#!/usr/bin/env python3
"""
初始化示例数据脚本
通过 AI 采集 API 批量导入文本类事件数据
"""

import requests
import time
import json

API_URL = "http://localhost:5001/api/ingest"

# 示例文本数据（招聘、讲座、活动）
SAMPLE_TEXTS = [
    # ========== 招聘类 ==========
    {
        "content": """内推|-文科生-"度小满"组织发展岗与产品经理岗

【招聘对象】2026届全日制硕士及以上学历毕业生

【岗位要求】

1.组织发展岗：
（1）人力资源管理、心理学、管理学等相关背景；
（2）具备系统思维与逻辑分析能力，能熟练运用Office及AI工具；
（3）对组织发展、人才管理有浓厚兴趣，具备优秀沟通表达与项目推动能力

2.AI 产品经理-人力系统方向：
（1）具备优秀的产品思维与系统设计能力；
（2）熟悉大模型技术逻辑，具备提示词工程、Agent流程或低代码平台实践经验者优先；
（3）对AI技术与组织管理有强烈兴趣，具备快速学习、结构化表达与跨团队推动能力。

【工作地点】北京

【截止时间】2025年12月20日（周五）中午12:00

【问卷链接】https://career.wjx.cn/vm/eCMU7Q0.aspx""",
        "type": "text"
    },
    
    {
        "content": """【美团2026届春招】产品经理岗位开放申请

📌 招聘对象：2026届本科及以上学历毕业生
📌 工作地点：北京/上海/深圳

岗位方向：
- 用户产品经理
- 商业产品经理
- 策略产品经理
- 数据产品经理

岗位要求：
1. 具备良好的逻辑思维和数据分析能力
2. 对互联网产品有浓厚兴趣，有产品实习经验优先
3. 优秀的沟通协调能力和团队合作精神

投递截止：2025年12月25日

投递链接：https://zhaopin.meituan.com/campus""",
        "type": "text"
    },
    
    {
        "content": """【字节跳动】2026届校园招聘-算法工程师

🎯 招聘对象：2026届硕士/博士毕业生

💼 岗位方向：
- 推荐算法工程师
- NLP算法工程师
- 计算机视觉算法工程师
- 机器学习平台工程师

📍 工作地点：北京、上海、深圳、杭州

✅ 岗位要求：
1. 计算机、数学、统计学等相关专业
2. 熟悉机器学习、深度学习基础理论
3. 熟练使用Python，了解TensorFlow/PyTorch等框架
4. 有顶会论文或竞赛获奖经历优先

⏰ 截止日期：2025年12月30日

🔗 投递入口：https://jobs.bytedance.com/campus""",
        "type": "text"
    },
    
    {
        "content": """【腾讯】2026届暑期实习-后端开发工程师

招聘对象：2026届本科及以上学历在校生

实习时间：2025年7月-9月（至少2个月）

工作地点：深圳/北京/上海/成都

岗位职责：
1. 参与腾讯核心产品的后端系统开发
2. 负责高并发、高可用系统的设计与优化
3. 参与技术方案设计和代码评审

任职要求：
1. 计算机相关专业，熟悉C++/Go/Java至少一门语言
2. 了解常用数据结构和算法
3. 了解Linux系统和网络编程基础
4. 有开源项目经验或ACM竞赛经历优先

截止时间：2025年12月28日 18:00

投递链接：https://join.qq.com/post.html""",
        "type": "text"
    },
    
    {
        "content": """【阿里巴巴】2026届校招-数据分析师

📊 岗位名称：数据分析师
🎓 招聘对象：2026届本科及以上毕业生
📍 工作城市：杭州/北京/上海

岗位职责：
- 负责业务数据分析，挖掘业务增长机会
- 搭建数据指标体系，监控业务健康度
- 通过数据驱动产品迭代和运营决策

岗位要求：
1. 统计学、数学、计算机等相关专业
2. 熟练使用SQL，了解Python/R数据分析
3. 具备良好的数据敏感度和业务理解能力
4. 有数据分析实习经验优先

薪资待遇：具有竞争力的薪酬+股票期权

截止日期：2025年12月22日

申请链接：https://talent.alibaba.com""",
        "type": "text"
    },
    
    # ========== 讲座类 ==========
    {
        "content": """【CDC职业发展讲座】AI时代的职业规划与转型

📅 时间：2025年12月18日（周三）19:00-21:00
📍 地点：商学院报告厅 B201

主讲嘉宾：
张明博士 - 前Google高级产品经理，现任某AI创业公司CEO

讲座内容：
1. AI技术发展趋势与就业市场变化
2. 如何在AI时代找准职业定位
3. 传统岗位如何拥抱AI转型
4. 互动问答环节

适合人群：对AI行业感兴趣的在校生

报名方式：扫描海报二维码或点击链接报名
报名截止：12月17日 18:00

名额有限，先到先得！""",
        "type": "text"
    },
    
    {
        "content": """【清华经管学院】创业者分享会

主题：从0到1：我的创业故事

时间：2025年12月19日 14:00-16:30
地点：清华经管学院伟伦楼报告厅

分享嘉宾：
- 王小明 - 某独角兽公司创始人
- 李华 - 连续创业者，天使投资人
- 陈思思 - 95后女性创业代表

议程安排：
14:00-14:30 嘉宾分享（一）
14:30-15:00 嘉宾分享（二）
15:00-15:30 嘉宾分享（三）
15:30-16:30 圆桌讨论&现场问答

报名链接：https://event.sem.tsinghua.edu.cn/startup2025
报名截止：12月18日 12:00""",
        "type": "text"
    },
    
    {
        "content": """【北大光华】金融科技前沿讲座

📌 主题：区块链与数字货币的未来

📅 日期：2025年12月20日（周五）
⏰ 时间：15:00-17:00
📍 地点：光华管理学院1号楼101教室

主讲人：
Dr. Michael Chen
- 哈佛大学经济学博士
- 前高盛数字资产部门主管
- 现任某知名加密货币交易所首席经济学家

讲座大纲：
1. 数字货币发展历程回顾
2. 央行数字货币(CBDC)全球进展
3. DeFi与传统金融的融合
4. 未来趋势展望

语言：英文（配中文字幕）

免费参加，需提前报名
报名截止：12月19日""",
        "type": "text"
    },
    
    # ========== 活动类 ==========
    {
        "content": """【商学院案例大赛】2025年度总决赛

🏆 赛事名称：商学院年度案例分析大赛
📅 决赛时间：2025年12月21日 9:00-17:00
📍 地点：商学院多功能厅

赛事亮点：
- 10支精英队伍同台竞技
- 知名企业高管担任评委
- 冠军奖金：10000元
- 优秀选手获得企业实习直通车

决赛流程：
09:00-09:30 开幕式
09:30-12:00 上半场比赛（5支队伍）
12:00-13:30 午餐休息
13:30-16:00 下半场比赛（5支队伍）
16:00-17:00 颁奖典礼

欢迎全校师生前来观摩！
现场观众有机会获得精美礼品""",
        "type": "text"
    },
    
    {
        "content": """【校园招聘会】2025冬季大型双选会

📅 时间：2025年12月22日（周日）9:00-16:00
📍 地点：体育馆

参会企业（部分）：
- 互联网：腾讯、阿里、字节、美团、京东
- 金融：中金、中信、高盛、摩根士丹利
- 咨询：麦肯锡、BCG、贝恩
- 快消：宝洁、联合利华、欧莱雅

招聘岗位：
产品经理、软件工程师、数据分析师、
投行分析师、咨询顾问、市场营销等

参会须知：
1. 请携带简历（建议10份以上）
2. 着正装参加
3. 提前了解心仪企业

无需报名，凭学生证入场""",
        "type": "text"
    },
    
    {
        "content": """【创新创业大赛】"挑战杯"校内选拔赛

🎯 赛事介绍：
"挑战杯"全国大学生课外学术科技作品竞赛校内选拔

📅 报名截止：2025年12月25日
📅 初赛时间：2026年1月10日
📅 决赛时间：2026年2月20日

参赛类别：
A类：自然科学类学术论文
B类：哲学社会科学类调查报告
C类：科技发明制作类

奖项设置：
- 特等奖：1名，奖金5000元
- 一等奖：3名，奖金3000元
- 二等奖：5名，奖金1500元
- 三等奖：10名，奖金800元

获奖作品将代表学校参加省赛！

报名方式：发送作品简介至 innovation@school.edu.cn
咨询电话：010-12345678""",
        "type": "text"
    },
    
    {
        "content": """【读书会】《创新者的窘境》深度解读

📚 书目：《创新者的窘境》- 克莱顿·克里斯坦森

📅 时间：2025年12月23日（周一）19:30-21:00
📍 地点：图书馆三楼研讨室

活动内容：
1. 书籍核心观点梳理
2. 案例分析：柯达、诺基亚的衰落
3. 小组讨论：如何避免创新者窘境
4. 延伸阅读推荐

适合人群：
- 对商业创新感兴趣的同学
- 创业者或有创业想法的同学
- MBA/EMBA在读学生

报名方式：微信群内接龙
限额：30人
费用：免费

请提前阅读书籍前三章！""",
        "type": "text"
    },
]

def init_data():
    """批量导入示例数据"""
    print("=" * 60)
    print("🚀 开始初始化示例数据...")
    print("=" * 60)
    
    # 检查 API 服务是否可用
    try:
        health_response = requests.get("http://localhost:5001/health", timeout=5)
        if health_response.status_code != 200:
            print("❌ API 服务不可用，请先启动服务")
            return
        print("✅ API 服务连接正常\n")
    except requests.exceptions.RequestException as e:
        print(f"❌ 无法连接到 API 服务: {e}")
        print("请先运行: python3 api_server.py")
        return
    
    success_count = 0
    fail_count = 0
    
    for i, item in enumerate(SAMPLE_TEXTS, 1):
        print(f"\n📝 [{i}/{len(SAMPLE_TEXTS)}] 处理中...")
        print(f"   内容预览: {item['content'][:50]}...")
        
        try:
            response = requests.post(
                API_URL,
                json={
                    "content": item["content"],
                    "type": item["type"]
                },
                timeout=60  # AI 处理可能需要较长时间
            )
            
            result = response.json()
            
            if result.get("success"):
                success_count += 1
                data = result.get("data", {})
                print(f"   ✅ 成功: {data.get('title', '未知标题')}")
                print(f"      类型: {data.get('type', '未知')}")
                print(f"      标签: {', '.join(data.get('tags', []))}")
            else:
                fail_count += 1
                print(f"   ⚠️ 跳过: {result.get('message', '未知原因')}")
                
        except requests.exceptions.Timeout:
            fail_count += 1
            print(f"   ❌ 超时")
        except Exception as e:
            fail_count += 1
            print(f"   ❌ 错误: {e}")
        
        # 避免请求过快
        time.sleep(2)
    
    print("\n" + "=" * 60)
    print(f"📊 初始化完成!")
    print(f"   ✅ 成功: {success_count}")
    print(f"   ❌ 失败: {fail_count}")
    print("=" * 60)

if __name__ == "__main__":
    init_data()

