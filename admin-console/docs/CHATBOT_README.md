# 对话式智能采集功能

## 概述

对话式智能采集是 UniFlow 智汇流平台的增强功能，提供自然语言对话形式的信息采集体验。用户可以通过类似 ChatGPT 的对话界面，用自然语言描述活动信息，AI 会自动提取结构化数据并引导补全缺失字段。

## 实现状态

### ✅ 阶段 A（当前实现）- HTTP 多轮对话

**特性：**
- 自然语言描述活动信息
- AI 自动提取结构化字段（标题、时间、地点、类型等）
- 多轮对话补全缺失信息
- 支持文件上传（图片、PDF）
- 结构化预览与确认发布

**技术方案：**
- 前端：简化版 ChatInterface 组件
- 后端：HTTP API `/api/chat-simple`（无 WebSocket）
- 状态：内存会话（单实例）
- AI：复用现有 DeepSeek 解析能力

### 🗓 阶段 B（规划中）- 流式体验增强

**规划特性：**
- SSE 流式输出（打字效果）
- 更好的文件上传体验
- 会话历史持久化

### � 阶段 C（远期规划）- 规模化与推荐

**规划特性：**
- WebSocket 实时通信
- Redis 会话缓存（多实例部署）
- 智能推荐（基于历史、公司匹配）
- 并发会话管理、限流、监控

---

## 快速开始

### 环境要求

与管理后台相同，无需额外配置：
```bash
# .env.local
DEEPSEEK_API_KEY=your_deepseek_api_key
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 启动服务

```bash
cd admin-console
npm run dev
```

访问 http://localhost:3000/ingest，切换到「对话模式」即可使用。

---

## 使用指南

### 模式切换

在 AI 智能采集台页面，可以在两种模式间切换：

1. **表单模式**：传统的结构化多源输入
2. **对话模式**：ChatBot 自然语言对话

### 对话流程

1. **开始对话**：系统发送欢迎消息
2. **描述活动**：用自然语言描述活动信息（或直接粘贴公告）
3. **AI 提取**：自动识别标题、时间、地点、类型等
4. **信息补全**：AI 主动询问缺失的关键信息
5. **文件上传**：可上传图片或 PDF 作为补充
6. **预览确认**：查看结构化结果，确认后发布

### 支持的活动类型

- **招聘信息** (recruit)：实习、全职招聘、宣讲会
- **校园活动** (activity)：讲座、比赛、社团活动
- **讲座信息** (lecture)：学术讲座、培训课程

### 文件上传

支持的文件格式：
- 图片：JPG, PNG, GIF, WebP（最大 10MB）
- 文档：PDF（最大 10MB）

---

## API 接口

### 对话消息（阶段 A）

```typescript
// 发送消息并获取 AI 响应
POST /api/chat-simple
{
  "sessionId": "session_id",      // 可选，首次为空则自动创建
  "message": "活动描述内容",
  "currentDraft": { ... }         // 可选，当前已提取的草稿
}

// 响应
{
  "sessionId": "xxx",
  "reply": "AI 回复文本",
  "draft": { ... },               // 提取/更新后的结构化数据
  "missingFields": ["date", "location"],  // 缺失字段
  "isComplete": false             // 是否信息完整可发布
}
```

---

## 架构设计

### 阶段 A 架构（当前）

```
┌─────────────────────────────────────────────────┐
│                   前端 (React)                   │
├─────────────────────────────────────────────────┤
│  IngestView                                     │
│  ├── 表单模式: MultiSourceInput + ReviewArea   │
│  └── 对话模式: SimpleChatInterface             │
│       ├── MessageList (消息列表)               │
│       ├── ChatInput (输入框)                   │
│       └── DraftPreview (草稿预览)              │
└─────────────────────────────────────────────────┘
                        │
                        ▼ HTTP POST
┌─────────────────────────────────────────────────┐
│              后端 API (Next.js)                 │
├─────────────────────────────────────────────────┤
│  /api/chat-simple                              │
│  ├── 会话状态管理（内存 Map）                  │
│  ├── 调用 DeepSeek 解析 + 多轮引导            │
│  └── 返回结构化 draft + 缺失字段              │
└─────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────┐
│              现有基础设施                        │
├─────────────────────────────────────────────────┤
│  DeepSeek API  │  Supabase  │  文件上传        │
└─────────────────────────────────────────────────┘
```

### 数据流

```
用户输入 → HTTP POST → AI 解析 → 提取/补全字段 → 返回 draft → 用户确认 → 发布
```

---

## 故障排除

### 常见问题

1. **AI 响应异常**
   - 检查 `DEEPSEEK_API_KEY` 是否配置
   - 确认网络连接正常
   - 查看浏览器控制台错误

2. **文件上传失败**
   - 检查文件大小（≤10MB）
   - 确认文件格式支持

3. **对话模式不显示**
   - 确认已切换到「对话模式」Tab
   - 刷新页面重试

---

## 许可证

MIT License